;SMARTOSC - TUANNA;File: charcoal.scm;Function: smartosc-charcoal;param(define (smartosc-charcoal imgURL inLayerURL photocopyMaskRadius photocopySharpness photocopyPercentBlack photocopyPercentWhite)(let* ((img (car (gimp-file-load RUN-NONINTERACTIVE imgURL imgURL)))(inLayer (car (gimp-image-get-active-layer img)))(width (car (gimp-drawable-width inLayer)))(x_off (min (trunc (/ width 2)) 200))(height (car (gimp-drawable-height inLayer)))(y_off (min (trunc (/ height 2)) 200))(layers 0)(layercount 0)(counter 0)(buffname "tilablebuf")(tileImage 0)(tileLayer 0)(tileLayer2 0))(gimp-image-undo-group-start img)(set! tileImage (car (gimp-image-duplicate img)))(gimp-image-undo-disable tileImage)(set! tileLayer (car (gimp-image-get-active-layer tileImage)))(set! layers (cadr (gimp-image-get-layers tileImage)))(set! layercount (car (gimp-image-get-layers tileImage)))(while (< counter layercount)(if (<> (vector-ref layers counter) tileLayer)(gimp-image-remove-layer tileImage (vector-ref layers counter)))(set! counter (+ 1 counter)))(gimp-drawable-offset tileLayer TRUE OFFSET-BACKGROUND x_off y_off)(plug-in-tile RUN-NONINTERACTIVE tileImage tileLayer (+ width x_off x_off) (+ height y_off y_off) FALSE)(plug-in-photocopy RUN-NONINTERACTIVE tileImage tileLayer photocopyMaskRadius photocopySharpness photocopyPercentBlack photocopyPercentWhite)(gimp-layer-set-mode tileLayer NORMAL-MODE)(gimp-palette-set-foreground '(255 255 255))(gimp-palette-set-background '(255 255 255))(set! tileLayer2 (car (gimp-layer-new tileImage width height RGB "New Layer" 10 GRAIN-MERGE-MODE)))(gimp-image-add-layer tileImage tileLayer2 0)(gimp-edit-fill tileLayer2 BG-IMAGE-FILL)(gimp-rect-select tileImage x_off y_off width height CHANNEL-OP-REPLACE FALSE 0)(set! buffname (car (gimp-edit-named-copy tileLayer buffname)))(gimp-floating-sel-anchor (car (gimp-edit-named-paste inLayer buffname FALSE)))(gimp-file-save RUN-NONINTERACTIVE tileImage inLayer inLayerURL inLayerURL)(gimp-image-delete tileImage)(gimp-image-undo-group-end img)(gimp-drawable-update inLayer 0 0 width height)(gimp-displays-flush)))(smartosc-charcoal \"{{fileinput}}\" \"{{fileoutput}}\" 12 1 0.2 0.5)(gimp-quit 0);register the function with GIMP(script-fu-register                    "smartosc-charcoal"                 ;function name                    _"Charcoal Effect"                  ;menu label                    "Adding an Antique Photo Border"    ;description                    "Nguyen Anh Tuan"                   ;author                    "tuanna <tuanna@smartosc.com>"      ;copyright                    "18/06/2012"                        ;date created                    "*"                                 ;image type that the script works on                    SF-IMAGE       "Input image"          0                    SF-DRAWABLE    "Input drawable"       0                    ;SF-STRING       "Input image"          "" ;url input                    ;SF-STRING       "Output image"       "" ;url output                    SF-ADJUSTMENT _"Photocopy Mask Radius"      '(12 3 50 0.01 1 2 1)  ;'(value lower upper step_inc page_inc digits type)                    SF-ADJUSTMENT _"Photocopy Sharpness"        '(1 0 1 0.001 0.01 3 1)                    SF-ADJUSTMENT _"Photocopy Percent Black"    '(0.2 0 1 0.001 0.01 3 1)                    SF-ADJUSTMENT _"Photocopy Percent White"    '(0.5 0 1 0.001 0.01 3 1));register(script-fu-menu-register "smartosc-charcoal" _"<Image>/SmartOSC")